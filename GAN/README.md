# GAN - 생성적 적대 신경망

## GAN 소개

적대적인 **생성자와 판별자** 네트워크 두 개가 경쟁하는 것

- 생성자 : 랜덤한 잡음을 원본 데이터셋에서 샘플링한 것처럼 보이는 샘플로 변환

- 판별자 : 원본 데이터셋에서 추출한 샘플인지 생성자가 만든 가짜인지 구별

**반복 과정**

1. 처음에 생성자는 잡음투성이인 이미지를 출력하고 판별자는 무작위로 예측

2. 생성자는 판별자를 속이는데 더 능숙해지고 판별자가 가짜 샘플을 정확하게 구별하는 능력 유지하도록 적응해 나간다.

3. 다시 생성자가 판별자를 속이기 위한 새로운 방법을 찾도록 만든다

**GAN의 핵심** : 두 네트워크를 어떻게 교대로 훈련하는지에 있다

## 첫번째 GAN

### 판별자

**판별자의 목표** : 이미지가 진짜인지 가짜인지 예측하는 것 -> 지도학습의 분류 문제 

-> 합성곱 층을 쌓고 완전 연결 층을 출력층으로 놓은 네트워크 구조 사용 가능

### 생성자

GAN의 생성자는 **VAE의 디코더**와 동일한 목적 수행 -> 잠재 공간의 벡터를 이미지로 변환

**UpSampling2D + Conv2D와 Conv2DTranspose** 모두 원본 이미지 차원으로 되돌리는 데 사용할 수 있는 변환 방법 -> 두 방법 모두 사용해보고 더 잘 맞는것 선택하기

### GAN 훈련

- 훈련 세트에서 진짜 샘플을 랜덤하게 선택하고 생성자의 출력을 합쳐서 훈련 세트를 만들어 판별자를 훈련
- 입력은 랜덤하게 생성한 100차원 잠재 공간 벡터이고 출력은 1인 훈련 배치를 만들어 전체 모델 훈련
- 손실 함수는 이진 크로스엔트로피 손실
- 학습률은 GAN 문제에 따라 주의 깊게 튜닝해야 하는 파라미터

진짜 이미지가 잠재 공간의 어떤 포인트에 매핑되는지 알려 주는 훈련 세트가 없기 때문에 생성자 훈련이 더 어려움 대신 판별자를 속이는 이미지 생성       

​	-> 이미지가 판별자의 입력으로 주입될 때 1에 가까운 값이 출력되어야 함

전체 모델 훈련 시 생성자의 가중치만 업데이트 되도록 **판별자의 가중치를 동결**해야 함       

​	-> 동결하지 않으면 생성된 이미지를 진짜라고 여기도록 조정됨

판별자가 약해서가 아닌 생성자가 강해서 생성된 이미지가 1(진짜 이미지)에 가까운 값으로 예측되어야 함

원본 픽셀 이외에는 모델에 어떤 추가적인 정보를 제공하지 않고도 랜덤한 잡음을 의미 있는 것으로 바꾸는 것이 가능

## GAN의 도전 과제

GAN이 생성 모델링 분야의 커다란 혁신이지만 훈련이 어렵다

### 진동하는 손실

판별자와 생성자의 손실이 장기간 안정된 모습을 보여주지 못하고 큰 폭으로 진동하기 시작할 수 있음

그러나 심하게 출렁이는 것이 아닌 손실이 안정되거나 점진적으로 증가하거나 감소하는 형태를 보여야 함

### 모드 붕괴

**모드 붕괴**는 생성자가 판별자를 속이는 적은 수의 샘플을 찾을 때 일어난다. -> 한정된 이 샘플 이외 다른 샘플 생성 불가

이유 : 생성자는 판별자를 항상 속이는 하나의 샘플을 찾으려는 경향이 있고 잠재 공간의 모든 포인트를 이 샘플에 매핑 가능 -> 손실 함수의 그레이디언트가 0에 가까운 값으로 무너진다는 뜻

### 유용하지 않은 손실

딥러닝 모델은 생성자의 손실이 작을 수록 생성된 이미지 품질이 더 좋다고 생각할 수 있다

그러나 생성자는 현재 판별자에 의해서만 평가되고 판별자는 계속 향상 되기에 훈련 과정의 다른 지점에서 평가된 손실 비교불가

-> 생성자의 손실과 이미지 품질 사이의 연관성 부족은 GAN 훈련 과정을 모니터링하기 어렵게 만든다

### 하이퍼파라미터

간단한 GAN이여도 튜닝해야 할 하이퍼파라미터의 개수가 상당히 많음

-> 판별자와 생성자의 전체 구조, 배치 정규화, 드롭아웃, 학습률, 활성화 층, 합성곱 필터, 커널 크기, 배치 크기, 스트라이드, 잠재 공간 크기 결정 등

GAN은 이런 파라미터의 작은 변화에도 매우 민감

## WGAN - 와서스테인 GAN

와서스테인 GAN은 안정적인 GAN 훈련을 위한 첫 번째 큰 발전 중 하나